<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <link href="todoAppLogo.svg" rel="icon">
        <title>Todo App</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- Bootstrap -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
        <!-- CSS Stylesheet -->
        <link rel="stylesheet" href="styles.css">
    </head>
    <body onload="readTodos()" id="body">
        <div class="container">
            <h1>Todos</h1>
            <div class="form-group">
                <label for="input">New todo</label>
                <input type="text" class="form-control" id="input" placeholder="Write todo here...">
            </div>
            <button onclick="createTodo()" id="addTodoBtn" type="submit" class="btn btn-primary">Add</button>
            <ul id="todosUl" class="list-group">
                <!-- GET data displayed here -->
            </ul>
            <div class="twtrLink"><a href="https://www.twitter.com/KevalinKetcham">@KevalinKetcham</a></div>
        </div>
    </body>
    <script>
        const liItm = document.getElementsByClassName("liItm");
        const appURL = 'http://localhost:3000';

        // Create todo
        function createTodo() {
            newTodo = {
                todo: '' + document.getElementById("input").value + ''
            }
            fetch(appURL, {
                method: "POST",
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(newTodo)
            }).then(readTodos());
        };

        // Read todos
        function readTodos() {
            fetch(appURL, {
                method: "GET"
            })
            .then(function (res) {
                return res.json();
            })
            .then(function (todos) {
                appendData(todos);
            })
            .catch(function (err) {
                console.log('Cannot fetch todos. Err: ' + err);
                if (err == "TypeError: Failed to fetch") {
                    alert("Backend is off");
                }
            });

            function appendData(data) {
                const todosUl = document.getElementById("todosUl");
                
                for (var i = 0; i < data.length; i++) {
                    let liGroup = document.createElement("li");
                    liGroup.setAttribute('class', 'list-group-item');

                    let todo = document.createElement("span");
                    todo.setAttribute('class', 'todos');

                    todo.innerHTML = data[i].todo

                    liGroup.appendChild(todo);
                    todosUl.appendChild(liGroup);
                };
            };
        };

        // <li class="list-group-item">
        //     <span class="liItm">
        //         <span class="todos">Cras justo odio</span>
        //         <span class="ulBtns">
        //             <button onclick="showInput()" type="button" class="btn btn-secondary ulBtn">Edit</button>
        //             <button onclick="deleteTodo()" type="button" class="btn btn-danger ulBtn">x</button>
        //         </span>
        //     </span>
        //     <span class="editTodo">
        //         <input class="editInput form-control"></input>
        //         <button onclick="updateTodo()" type="button" class="btn btn-primary ulBtn">Done</button>
        //     </span>
        // </li>

        // fetch(appURL, {
        //     method: "GET"
        // }).then(function(res) {
        //     console.log(res);
        //     document.write(res);
        // });

        // Update todo
        function showInput(liItm) {
        }

        function updateTodo() {
            fetch(appURL, {
                method: "PUT",
            });
        }

        // Delete todo
        function deleteTodo() {
            fetch(appURL, {
                method: "DELETE",
            });
        }

    </script>
</html>